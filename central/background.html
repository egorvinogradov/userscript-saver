<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

	<title></title>

	<script src="less.js"></script>
	<script src="Router.js"></script>
	<script src="bundleEmbedder.js"></script>

	<script>
		function taistTabUp(tab) {
			TaistiesStorage.getTaistiesForUrl(tab.url, function(bundles) {
				insertTaistiesToPage(bundles, tab.id)
			})
		}

		// listening to requests
		chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
			taistTabUp(sender.tab);

			sendResponse({});
		})
	</script>

	<script>
		var routes = {
			'lenta\\.ru': {
				css: '.hidden { display: none !important }',
				jslib: [],
				js: "var settings = {\n\tpreferred: ['/science/', '/internet/', '/digital/', '/game/']\n}\n\nvar nav = document.querySelector('td.nav')\nvar groups = [].slice.call(nav.querySelectorAll('div.group'), 0)\n\ngroups.forEach(function(group) {\n\tvar links = [].slice.call(group.querySelectorAll('a'), 0)\n\tvar hiddenCount = 0\n\tlinks.forEach(function(link) {\n\t\tvar href = link.getAttribute('href')\n\t\tif (settings.preferred.indexOf(href) == -1) {\n\t\t\tlink.parentNode.className += ' hidden'\n\t\t\thiddenCount++\n\t\t}\n\t})\n\n\tif (hiddenCount == links.length) {\n\t\tgroup.className += ' hidden'\n\t}\n})"
			}
		}

		localStorage.setItem('routes', JSON.stringify(routes))
	</script>

</head>
<body>

</body>
</html>
